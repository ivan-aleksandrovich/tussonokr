<?xml version="1.0" encoding="UTF-8"?>
<!-- Шаблон отчета по позициям сторнированным в течении смены. -->
<report name = "streport" type="shift" cached="true" title="Отчет сторно">
<text padding="2">ОТЧЕТ ПО СТОРНИРОВАННЫМ ПОЗИЦИЯМ</text><br/>
<text fillsymbol="-" maxwidth="all"/><br/>
<text>КАССА        : $cash.code$</text><br/>
<text>СМЕНА        : $shift.num$</text><br/>
<text>ДАТА         : </text><var name="now" dateformat="dd/mm/yyyy"/><br/>
<text>ВРЕМЯ        : </text><var name="now" dateformat="hh:mi"/><br/>
<text>НАПЕЧАТАЛ    : $user.code$ $user.name$</text><br/>
<text fillsymbol="=" maxwidth="all"/><br/>
<text fillsymbol="-" maxwidth="all"/><br/>
<text>СТОРНИРОВАННЫЕ ТОВАРЫ</text><text maxwidth="all" align="right">СУММА</text><br/>
<text fillsymbol="-" maxwidth="all"/><br/>
<select query="select doc.checknum, case st.opcode
      when 52 then 'CУММА В ОТДЕЛ'
      when 60 then 'CУММА В ОТДЕЛ'
      else st.bcode end
 as bcode, cast((case st.opcode
      when 52 then concat('ОТДЕЛ ' , DEPTCODE)
      when 60 then concat('ОТДЕЛ ' , DEPTCODE)
      else st.name end) as CHAR)
 as name,
 st.bquant,
 st.sumb,
 st.price,
 cast((case when st.opcode in (1000, 50, 52) then 'продажа'
      when st.opcode in (54, 56, 58, 60) then 'возврат'
      else 'неопр.' end) as CHAR)
  AS optype,
  st.deptcode from stornogoodsitem st,document doc
				where st.documentid = doc.documentid and doc.workshiftid=$shift.id$
				order by doc.checknum">
<text>ЧЕК </text> 
<var name="checknum" minwidth="3" align="right" fillsymbol="0"/><text>(</text><var name="optype"/><text>) ТОВАР</text><nbsp/><var name="bcode"/><br/>
<var name="name"/><br/>
<var name="bquant" minwidth="10" maxwidth="10" afterpoint="3" align="right"/><text><nbsp/>*<nbsp/></text>
<var name="price" minwidth="10" maxwidth="20" afterpoint="2" align="right"/><text><nbsp/>=<nbsp/></text>
<var name="sumb" minwidth="10" maxwidth="20" afterpoint="2" align="right"/><br/>
</select>
<text fillsymbol="-" maxwidth="all"/><br/>
<select query="select count(st.sumb) cnt, sum(st.sumb) sm from stornogoodsitem st,document doc
				where st.documentid = doc.documentid and doc.workshiftid=$shift.id$">
<text maxwidth="all">ВСЕГО ПОЗИЦИЙ</text><var name="cnt" maxwidth="all"/><nbsp/><text maxwidth="all">СУММА</text><nbsp/><var name="sm" maxwidth="all" align="right"/><br/>
</select>
<text fillsymbol="=" maxwidth="all"/><br/>
</report>
