<?xml version="1.0" encoding="windows-1251"?>
<!-- Шаблон для формирования выгрузки результатов продаж в формате Домино. -->
<report>
<text>КОНТРОЛЬНАЯ ЛЕНТА</text><br/>
<!--text>ДАТА=</text><select query="select case (select count(time_end) from sdata where shift = $shift_number$) when 0 then cast('$cur_date_point$ $cur_time$' as timestamp) else (select time_beg from sdata where shift = $shift_number$) end as dt from rdb$$database"><var name="dt" dateformat="d2/mm/yyyy"/></select><br/-->
<text>ДАТА=</text><select query="select coalesce((select first 1 time_end from sdata where shift = $shift_number$),cast('$cur_date_point$ $cur_time$' as timestamp)) as dt from rdb$$database"><var name="dt" dateformat="d2/mm/yyyy"/></select><br/>
<text>ДАТА НАЧАЛА СМЕНЫ=</text><select query="select coalesce((select first 1 time_beg from sdata where shift = $shift_number$),cast('$shift_date_point$ $cur_time$' as timestamp)) as dt from rdb$$database"><var name="dt" dateformat="d2/mm/yyyy"/></select><br/>
<text>ВРЕМЯ=</text><select query="select case (select count(time_end) from sdata where shift = $shift_number$) when 0 then cast('$cur_date_point$ $cur_time$' as timestamp) else (select time_end from sdata where shift = $shift_number$) end as tm from rdb$$database"><var name="tm" dateformat="h2:mi"/></select><br/>
<text>КАССА=$cash_code$</text><br/>
<text>СЕАНС=$cash_code$/$shift_number$</text><br/>
<text>КАССИР=$user_name$</text><br/>
<br/>
<br/>
<select query="select * from clview2 left join cdata on cdata.checknum = clview2.checknum and cdata.shift = clview2.shift where clview2.shift = $shift_number$ and cdata.closed = 1 order by clview2.checknum">
<text>T=</text>
<var name="checknum" minwidth="8" align="right" fillsymbol="0"/><text>,</text>
<var name="ttime" dateformat="d2/mm/yyyy"/><text>,</text>
<var name="ttime" dateformat="hh:mi"/><text>,"</text>
<var name="stropcode" minwidth="2" align="right" fillsymbol="0"/><text>","$division$",1,"</text>
<var name="bcode"/><text>",1,1,1,</text>
<var name="real_price" afterpoint="5" minwidth="13" align="right"/><text>,1,1,1,</text>
<var name="real_quant" minwidth="11" maxwidth="11" numberformat="+011.3"/><text>,</text>
<var name="scode" minwidth="3" align="right"/><text>,</text>
<var name="vcode"/><text>,</text>
<var name="deptcode"/><text>,</text>
<var name="cardno"/><br/>
</select>
<br/>
<br/>
<select query="select * from mdata left join cdata on cdata.checknum = mdata.checknum and cdata.shift = mdata.shift and cdata.closed = 1 where mdata.shift = $shift_number$ order by mdata.checknum">
<text>M=</text>
<var name="checknum" minwidth="8" align="right" fillsymbol="0"/><text>,</text>
<var name="acode"/><text>,</text>
<var name="scode"/><text>,</text>
<var name="cashcode"/><text>,</text>
<var name="shift"/><text>,</text>
<var name="mtime" dateformat="d2/mm/yyyy"/><text>,</text>
<var name="mtime" dateformat="hh:mi"/><text>,</text>
<var name="opcode"/><text>,</text>
<var name="valcode"/><text>,</text>
<var name="nrate" afterpoint="4"/><text>,</text>
<var name="bond" afterpoint="4"/><text>,</text>
<var name="bond_quant"/><text>,</text>
<var name="vsum" afterpoint="2"/><text>,</text>
<var name="sumb" afterpoint="2"/><text>,</text>
<var name="sumn" afterpoint="2"/><text>,</text>
<var name="sume" afterpoint="2"/><text>,"</text>
<var name="docnum"/><text>",</text>
<var name="c_link"/><br/>
</select>
</report>
