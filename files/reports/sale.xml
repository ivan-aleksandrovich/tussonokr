<?xml version="1.0" encoding="UTF-8"?>
<!-- Шаблон чека продажи. Объединение одинаковых позиций и группировка по полю артикул. -->
<report name = "sale" type="document" cached="false" title="Чек продажи">

<select query="SELECT identifier FROM document WHERE documentid = $document.id$">
<printer op="barcode" type="CODE128"  barcode="{B$document.identifier$"/><br/>
<text align="left">ИДЕНТИФИКАТОР ЧЕКА</text>><var align="right" name="identifier" padding="1" maxwidth="all"/><br/>
</select>
    <!-- Рекламный текст для покупателя -->
    <!-- Печатаем если текст для печати есть -->
    <select query="SELECT rtext FROM documents.document d where d.documentid = $document.id$ and d.rtext IS NOT NULL AND TRIM(d.rtext) &lt;&gt; ''">
        <!-- Печатаем если в чеке нет карт с включеной опцией печати информации по карте -->
        <select query="select 1 from dual where not exists(select coalesce(g.printinfo, 0) d from documents.carditem c left join dictionaries.cardgroup g on c.idcardgroup = g.idcardgroup where c.documentid = $document.id$ and g.printinfo = 0)">
            <text>************************************</text><br/>
            <var name="rtext" maxwidth="36"  minwidth="36" align="center"/>

            <formattext var="document.rtext"/>
            <text>************************************</text><br/>
                    <select query="select dictionaries.cardgroup.name e from dictionaries.cardgroup where dictionaries.cardgroup.idcardgroup = (select documents.carditem.idcardgroup from documents.carditem where documents.carditem.documentid= $document.id$)">
                    <var name="e" align="center" minwidth="all"/><br/>
                    </select>                    
        </select>
    </select>

</report>
 
